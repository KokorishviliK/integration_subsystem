# Подписчики

Каждый исходящий поток может быть отправлен нескольким получателям. Для управления получателями создан справочник
"Подписчики".

## Основные параметры

Наименование
: Содержит наименование подписчика в текущей ИБ

Активен
: Если выключено, сообщения подписчику создаваться не будут

ТипПодписчика
: ПеречислениеСсылка.инт_ТипыПдписчиков - для разных типов будут использованы разные настройки отправки
    - ПроизвольныйHTTP - произвольный сервис, способный принять сообщение с указанными настройками
    - Подсистема интеграции - Система 1с, с добавленной в нее подсистемой интеграции.
    - JsonRPC 2.0 - Сервис, способный обрабатывать сообщения по стандарту jrpc
    - RabbitMQ - Отправка подготовленных сообщений в брокер.

КоличествоПопытокОтправки
: Количество попыток отправки сообщения, после которых оно будет признано проблемным

ПаузаМеждуПопыткамиОбработки
: Пауза(в секундах) между попытками отправки сообщения

СпособПередачиИдентификатораСообщения
: **Актуально только для типа подписчика "ПроизвольныйHTTP"**
Каждое сообщение должно содержать в себе информацию об uuid сообщения, этот параметр отвечает за способ передачи. (см. [](#transfer-methods)) 

СпособПередачиИдентификатораПотока
: **Актуально только для типа подписчика "ПроизвольныйHTTP"**
Каждое сообщение должно содержать в себе информацию об идентификаторе [потока данных](dataflow.md#flow_id), 
этот параметр отвечает за способ передачи. (см. [](#transfer-methods))

## Способы передачи основных параметров {id="transfer-methods"}

На данный момент существует возможность передавать основные параметры сообщений(Идентификатор потока, и UUID сообщения)
Следующими способами:
- В заголовке запроса
  - Идентификатор потока будет передан в заголовке `flow_id`
  - Идентификатор сообщения будет передан в заголовке `message_id`
- В параметре пути
  - Для корректной работы данного механизма шаблон url должен содержать параметры `{flow_id}` и `{message_id} `
    
    Пример: `https://example.com/api/{flow_id}/{message_id}`
- В параметрах запроса
  - Идентификатор потока будет передан в параметре `flow_id`
  - Идентификатор сообщения будет передан в параметре `message_id`

## Пост процессинг ответа сервиса

Подсистема интеграции позволяет выполнить произвольные действия на основании полученного ответа от подписчика. 

Это позволяет, например, добавить свой произвольный обработчик ошибок, или же, зафиксировать какие-то сведения, возвращаемые подписчиком в ответ на наше сообщение
(прим. Сервис возвращает внутренний идентификатор сообщения во внешней системе.)

Для этого необходимо указать ожидаемый код состояния ответа, и задать обработчик. 
В обработчик, помимо ответа сервиса, будет так-же передана ссылка на исходные данные сообщения(ссылка на объект). 
![post-processing.png](post-processing.png)