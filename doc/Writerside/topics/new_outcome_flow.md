# Добавление исходящего потока

Здесь описан алгоритм действий для добавления исходящего потока

> **Внимание! На данный момент регистрация исходящих потоков возможна только из кода конфигурации**
>
> Добавить исходящий поток без изменения конфигурации - не получится.
>
{style="warning"}

## Перед началом

Убедитесь, что: 
- Подсистема уже [интегрирована в конфигурацию](setup.md)

## Изменения конфигурации

Здесь будут описаны действия которые необходимо выполнить в конфигураторе, для подключения нового исходящего потока данных.

1. Добавьте тип данных, который будет являться основанием для сообщения в `ОпределяемыеТипы.инт_ИсходныеДанные`.

![addType.png](addType.png)

2. Добавьте предопределенный элемент справочника "инт_ПотокиДанных". {id="predefined"}
   - Укажите имя для обращения из кода конфигурации
   - Укажите в поле "код" [](dataflow.md#flow_id)
   - Укажите в поле наименование представление потока для пользователя.
3. Определите триггеры при которых должно формироваться сообщение(Прим: При каждой записи документа.)

4. В обработчики событий, которые вызываются при наступлении ключевых условий добавьте регистрацию сообщения.

```
РегистрыСведений.инт_ОчередьИсходящихСообщений
                .ЗарегистрироватьСообщение(СсылкаНаОбъект, Справочники.инт_ПотокиДанных.<ИмяПредопределенногоЭлемента>);
```

> Тут работают общие рекомендации по эффективной регистрации объектов.
> 
> Регистрацию лучше выполнять как можно ближе к концу транзакции.
{style="note"}

## Настройка в режиме предприятия

1. Запустите конфигурацию под пользователем с правами "инт_Администрирование".
2. Откройте [предопределенный элемент справочника](#predefined)
3. Заполните [](dataflow.md#flow_direction)
4. Заполните [](codeEditor.md#example)
5. Опишите обработчик, который по `ИсходнымДанным` создаст соответствие `Результат`
6. Заполните [](dataflow.md#processing_parametrs)

## Настройка валидации пакета

Если вы предполагаете валидировать ваш пакет, вам необходимо создать [схему данных](schemas.md) и настроить ее согласно документации

1. Активируйте переключатель [](dataflow.md#validate)
2. Выберите созданную openApi-схему данных
3. Укажите [](dataflow.md#flow_scheme_name)

> Валидация исходящих сообщений происходит в транзакции формирования сообщения, сразу после формирования.
> 
> Если сообщение не прошло валидацию - будет выдана ошибка, а сообщение будет помечено как ошибочное.
{style="note"}

## Настройка отслеживаемых реквизитов объекта

В подсистеме интеграции есть система позволяющая отслеживать изменения определенных реквизитов объекта.
> Это полезно в случае, если необходимо исключить "мусорные формирования сообщений" в случае изменения реквизитов не участвующих в интеграции.
>
{style="note"}

- Для ограничения отслеживаемых реквизитов нажмите на кнопку
   ![tracking_attrs.png](tracking_attrs.png){ style="block" }

- В открывшемся дереве, отметьте реквизиты объекта которые необходимо отслеживать(В приведенном примере при изменении `Демо реквизит строка` регистрация нового сообщения не произойдет)
   ![attrs_tree.png](attrs_tree.png) { style="block" }

- Убедитесь, что ваши изменения применены. Должна появиться соответствующая декорация
  ![decoration.png](decoration.png){ style="block" }

## Заполнение подписчиков

Выберите подписчиков, которым будет доставлено данное сообщение.

Возможно перед тем, как выбрать подписчиков, их потребуется создать. Для создания подписчиков, прочитайте [эту инструкцию](subscribers.md).
## Вместо заключения.
Все, поток добавлен, валидация включена. Теперь вы будете уверены, что ваше сообщение сформировано правильно и уйдет куда нужно.